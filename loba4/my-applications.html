<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ ¬´–õ–æ–±–∞—á–µ–≤—Å–∫–∏–π¬ª - –ú–æ–∏ –∑–∞—è–≤–∫–∏</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background-color: #f5f5f5;
        min-height: 100vh;
      }

      /* Header */
      .header {
        background-color: #fff;
        padding: 15px 40px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .logo svg {
        width: 100%;
        height: 100%;
      }

      .header-title {
        font-size: 18px;
        font-weight: 500;
        color: #333;
      }

      /* Container */
      .container {
        max-width: 1140px;
        margin: 60px auto;
        padding: 0 20px;
      }

      /* Page Header */
      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 40px;
      }

      .page-title {
        font-size: 36px;
        font-weight: 600;
        color: #000;
      }

      .btn-new-application {
        background: transparent;
        color: #0066cc;
        border: none;
        font-size: 18px;
        font-weight: 500;
        cursor: pointer;
        text-decoration: underline;
        padding: 0;
        transition: color 0.2s;
      }

      .btn-new-application:hover {
        color: #0052a3;
      }

      /* Phone Search Card */
      .phone-search-card {
        background: #f5f5f5;
        border-radius: 12px;
        padding: 24px 32px;
        margin-bottom: 32px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .phone-search-content {
        flex: 1;
      }

      .phone-number {
        font-size: 20px;
        font-weight: 600;
        color: #000;
        margin-bottom: 4px;
      }

      .phone-search-label {
        font-size: 14px;
        color: #666;
      }

      .arrow-icon {
        width: 24px;
        height: 24px;
        color: #999;
      }

      /* Help Link */
      .help-link {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 32px;
        color: #0066cc;
        text-decoration: none;
        font-size: 16px;
        width: fit-content;
      }

      .help-link:hover {
        text-decoration: underline;
      }

      .help-icon {
        width: 20px;
        height: 20px;
        border: 2px solid #0066cc;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: bold;
      }

      /* Tabs */
      .tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 32px;
      }

      .tab {
        flex: 1;
        background: #fff;
        border: none;
        padding: 16px 24px;
        font-size: 16px;
        font-weight: 500;
        color: #666;
        cursor: pointer;
        border-radius: 8px;
        transition: all 0.2s;
      }

      .tab:hover {
        background: #f8f9fa;
      }

      .tab.active {
        background: #fff;
        color: #000;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      /* Applications List */
      .applications-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .application-card {
        background: #fff;
        border-radius: 12px;
        padding: 24px 32px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);
        transition: box-shadow 0.2s;
        cursor: pointer;
      }

      .application-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
      }

      .application-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 12px;
        font-size: 14px;
        color: #666;
      }

      .application-date {
        color: #666;
      }

      .application-dot {
        width: 4px;
        height: 4px;
        background: #999;
        border-radius: 50%;
      }

      .application-source {
        color: #666;
      }

      .application-number {
        font-size: 20px;
        font-weight: 600;
        color: #000;
        margin-bottom: 8px;
      }

      .application-status {
        display: inline-block;
        color: #0066cc;
        font-size: 16px;
        font-weight: 500;
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #999;
        font-size: 16px;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .page-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 16px;
        }

        .page-title {
          font-size: 28px;
        }

        .header {
          padding: 15px 20px;
        }

        .phone-search-card {
          padding: 20px;
        }

        .phone-number {
          font-size: 18px;
        }

        .tabs {
          flex-direction: column;
        }

        .application-card {
          padding: 20px;
        }

        .application-number {
          font-size: 18px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="logo">
        <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect
            x="5"
            y="5"
            width="30"
            height="30"
            stroke="#000"
            stroke-width="2"
            fill="none"
          />
          <path
            d="M15 20 L20 25 L25 15"
            stroke="#000"
            stroke-width="2"
            fill="none"
          />
        </svg>
      </div>
      <div class="header-title">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ ¬´–õ–æ–±–∞—á–µ–≤—Å–∫–∏–π¬ª</div>
    </div>

    <!-- Main Content -->
    <div class="container">
      <!-- Page Header -->
      <div class="page-header">
        <h1 class="page-title">–ú–æ–∏ –∑–∞—è–≤–∫–∏</h1>
        <button class="btn-new-application" onclick="createNewApplication()">
          –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É
        </button>
      </div>

      <!-- Phone Search Card -->
      <div class="phone-search-card" onclick="changePhone()">
        <div class="phone-search-content">
          <div class="phone-number" id="phoneNumber">+7 (904) 904-13-28</div>
          <div class="phone-search-label">–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫ —Å —ç—Ç–æ–≥–æ –Ω–æ–º–µ—Ä–∞</div>
        </div>
        <svg
          class="arrow-icon"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M9 5l7 7-7 7"
          ></path>
        </svg>
      </div>

      <!-- Help Link -->
      <a
        href="#"
        class="help-link"
        onclick="event.preventDefault(); showHelp()"
      >
        <span class="help-icon">?</span>
        –ö–∞–∫ –Ω–∞–π—Ç–∏ –¥—Ä—É–≥–∏–µ –∑–∞—è–≤–∫–∏
      </a>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab('active', this)">
          –ê–∫—Ç–∏–≤–Ω—ã–µ
        </button>
        <button class="tab" onclick="switchTab('closed', this)">
          –ó–∞–∫—Ä—ã—Ç—ã–µ
        </button>
      </div>

      <!-- Applications List -->
      <div class="applications-list" id="applicationsList">
        <!-- Applications will be dynamically loaded here -->
      </div>
    </div>

    <script src="api-client.js"></script>
    <script>
      let allApplications = [];
      let currentTab = "active";
      let currentPhone = "";

      // Initialize page
      async function init() {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        const savedPhone = localStorage.getItem("userPhone");
        if (savedPhone) {
          currentPhone = savedPhone;
          document.getElementById("phoneNumber").textContent = currentPhone;
        } else {
          // –ï—Å–ª–∏ –Ω–æ–º–µ—Ä–∞ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞
          changePhone();
          return;
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞—è–≤–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
        await loadApplications();
      }

      // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
      async function loadApplications() {
        if (!currentPhone) {
          renderApplications();
          return;
        }

        try {
          console.log("üì• –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫ –¥–ª—è –Ω–æ–º–µ—Ä–∞:", currentPhone);
          allApplications = await ComplaintsAPI.getComplaintsByPhone(
            currentPhone
          );
          console.log("‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞—è–≤–æ–∫:", allApplications.length);
          renderApplications();
        } catch (error) {
          console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫:", error);
          document.getElementById("applicationsList").innerHTML = `
            <div class="empty-state">
              –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω.<br>
              <small style="color: #999; margin-top: 8px; display: block;">
                –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –∫–æ–º–∞–Ω–¥–æ–π: cd adminka && npm start
              </small>
            </div>
          `;
        }
      }

      // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –¥–∞—Ç—É –≤ —á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç
      function formatDate(dateString) {
        const date = new Date(dateString);
        const options = { day: "numeric", month: "long", year: "numeric" };
        return "–æ—Ç " + date.toLocaleDateString("ru-RU", options) + " –≥–æ–¥–∞";
      }

      // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–∞—è–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π
      function isActiveStatus(status) {
        const activeStatuses = [
          "–ù–æ–≤–æ–µ",
          "–ü—Ä–∏–Ω—è—Ç–æ –≤ —Ä–∞–±–æ—Ç—É",
          "–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏",
          "–í —Ä–∞–±–æ—Ç–µ",
        ];
        return activeStatuses.includes(status);
      }

      // Render applications
      function renderApplications() {
        const container = document.getElementById("applicationsList");

        // –§–∏–ª—å—Ç—Ä—É–µ–º –∑–∞—è–≤–∫–∏ –ø–æ —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–µ
        const filteredApps = allApplications.filter((app) => {
          if (currentTab === "active") {
            return isActiveStatus(app.status);
          } else {
            return !isActiveStatus(app.status);
          }
        });

        if (filteredApps.length === 0) {
          const message =
            currentTab === "active"
              ? "–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
              : "–ó–∞–∫—Ä—ã—Ç—ã—Ö –∑–∞—è–≤–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ";
          container.innerHTML = `
            <div class="empty-state">
              ${message}
            </div>
          `;
          return;
        }

        container.innerHTML = filteredApps
          .map(
            (app) => `
          <div class="application-card" onclick="openApplication(${app.id})">
            <div class="application-header">
              <span class="application-date">${formatDate(
                app.created_at || app.created_date
              )}</span>
              <span class="application-dot"></span>
              <span class="application-source">${
                app.external_system || "–°–∞–π—Ç lbch.ru"
              }</span>
            </div>
            <div class="application-number">‚Ññ${app.id}</div>
            <div class="application-status">${app.status}</div>
          </div>
        `
          )
          .join("");
      }

      // Switch tab
      function switchTab(tab, element) {
        currentTab = tab;

        // Update active tab
        document.querySelectorAll(".tab").forEach((t) => {
          t.classList.remove("active");
        });
        element.classList.add("active");

        // Render applications for the selected tab
        renderApplications();
      }

      // Open application details
      function openApplication(id) {
        console.log("–û—Ç–∫—Ä—ã—Ç—å –∑–∞—è–≤–∫—É ‚Ññ" + id);
        // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        window.location.href = `complaint-detail.html?id=${id}`;
      }

      // Create new application
      function createNewApplication() {
        window.location.href = "index.html";
      }

      // Change phone number
      async function changePhone() {
        const currentDisplayPhone =
          document.getElementById("phoneNumber").textContent;
        const defaultValue =
          currentDisplayPhone && currentDisplayPhone !== "+7 (___) ___-__-__"
            ? currentDisplayPhone
            : "+7 (";

        const newPhone = prompt(
          "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞—è–≤–æ–∫:",
          defaultValue
        );

        if (newPhone && newPhone.trim() !== "") {
          currentPhone = newPhone.trim();
          document.getElementById("phoneNumber").textContent = currentPhone;
          localStorage.setItem("userPhone", currentPhone);

          // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞—è–≤–∫–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞
          console.log("–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫ –¥–ª—è –Ω–æ–º–µ—Ä–∞:", currentPhone);
          await loadApplications();
        }
      }

      // Show help
      function showHelp() {
        alert(
          "–ß—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –∑–∞—è–≤–∫—É:\n\n" +
            "1. –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ø—Ä–∏ –ø–æ–¥–∞—á–µ –∑–∞—è–≤–∫–∏\n" +
            "2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª '–ê–∫—Ç–∏–≤–Ω—ã–µ' –¥–ª—è —Ç–µ–∫—É—â–∏—Ö –∑–∞—è–≤–æ–∫\n" +
            "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª '–ó–∞–∫—Ä—ã—Ç—ã–µ' –¥–ª—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫\n\n" +
            "–ï—Å–ª–∏ –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ —Å–≤–æ—é –∑–∞—è–≤–∫—É, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π: +7 (831) 467-10-01"
        );
      }

      // Initialize on page load
      init();
    </script>
  </body>
</html>
