<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #f5f5f5;
        padding: 40px 20px;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: #fff;
        border-radius: 12px;
        padding: 40px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      h1 {
        font-size: 28px;
        margin-bottom: 10px;
        color: #333;
      }

      .status {
        padding: 12px 20px;
        border-radius: 8px;
        margin-bottom: 30px;
        font-weight: 500;
      }

      .status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .status.loading {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .test-section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
      }

      .test-section h2 {
        font-size: 20px;
        margin-bottom: 15px;
        color: #0066cc;
      }

      .test-section p {
        color: #666;
        margin-bottom: 15px;
        line-height: 1.6;
      }

      button {
        background: #0066cc;
        color: #fff;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      button:hover {
        background: #0052a3;
      }

      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      input {
        padding: 10px 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 15px;
        margin-right: 10px;
        margin-bottom: 10px;
        width: 250px;
      }

      .result {
        margin-top: 15px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 6px;
        font-family: monospace;
        font-size: 13px;
        max-height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
        word-break: break-all;
      }

      .info {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 30px;
        border-left: 4px solid #0066cc;
      }

      .info strong {
        color: #0066cc;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</h1>

      <div id="serverStatus" class="status loading">
        –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É...
      </div>

      <div class="info">
        <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br />
        –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: <code>cd adminka && npm start</code
        ><br />
        –°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ <code>http://localhost:3000</code>
      </div>

      <!-- Test 1 -->
      <div class="test-section">
        <h2>1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞—è–≤–∫—É</h2>
        <p>–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∑–∞—è–≤–∫—É –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.</p>
        <button onclick="testCreateComplaint()">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
        <div id="result1" class="result" style="display: none"></div>
      </div>

      <!-- Test 2 -->
      <div class="test-section">
        <h2>2. –ü–æ–ª—É—á–∏—Ç—å –∑–∞—è–≤–∫–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É</h2>
        <p>
          –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞—è–≤–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä: +7 (904)
          904-13-28)
        </p>
        <input
          type="text"
          id="phoneInput"
          placeholder="+7 (904) 904-13-28"
          value="+7 (904) 904-13-28"
        />
        <button onclick="testGetByPhone()">–ù–∞–π—Ç–∏ –∑–∞—è–≤–∫–∏</button>
        <div id="result2" class="result" style="display: none"></div>
      </div>

      <!-- Test 3 -->
      <div class="test-section">
        <h2>3. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞—è–≤–∫–∏</h2>
        <p>–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.</p>
        <button onclick="testGetAllComplaints()">–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞—è–≤–∫–∏</button>
        <div id="result3" class="result" style="display: none"></div>
      </div>

      <!-- Test 4 -->
      <div class="test-section">
        <h2>4. –ü–æ–ª—É—á–∏—Ç—å –∑–∞—è–≤–∫—É –ø–æ ID</h2>
        <p>–í–≤–µ–¥–∏—Ç–µ ID –∑–∞—è–≤–∫–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.</p>
        <input type="number" id="idInput" placeholder="ID –∑–∞—è–≤–∫–∏" value="1" />
        <button onclick="testGetById()">–ü–æ–ª—É—á–∏—Ç—å –∑–∞—è–≤–∫—É</button>
        <div id="result4" class="result" style="display: none"></div>
      </div>
    </div>

    <script src="api-client.js"></script>
    <script>
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
      async function checkServer() {
        const statusDiv = document.getElementById("serverStatus");
        try {
          const isOnline = await ComplaintsAPI.checkServer();
          if (isOnline) {
            statusDiv.className = "status success";
            statusDiv.textContent = "‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç";
          } else {
            statusDiv.className = "status error";
            statusDiv.textContent =
              "‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: cd adminka && npm start";
          }
        } catch (error) {
          statusDiv.className = "status error";
          statusDiv.textContent =
            "‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É: " + error.message;
        }
      }

      // Test 1: –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É
      async function testCreateComplaint() {
        const resultDiv = document.getElementById("result1");
        resultDiv.style.display = "block";
        resultDiv.textContent = "‚è≥ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏...";

        try {
          const testData = {
            title: "–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞ " + new Date().toLocaleString("ru-RU"),
            description:
              "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",
            author: "–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¢–µ—Å—Ç–æ–≤–∏—á",
            author_phone: "+7 (904) 904-13-28",
            author_address: "—É–ª. –¢–µ—Å—Ç–æ–≤–∞—è, –¥. 1",
            status: "–ù–æ–≤–æ–µ",
            external_system: "–°–∞–π—Ç lbch.ru (—Ç–µ—Å—Ç)",
            created_date: new Date().toISOString(),
          };

          const result = await ComplaintsAPI.createComplaint(testData);
          resultDiv.textContent = JSON.stringify(result, null, 2);

          alert(`‚úÖ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!\nID –∑–∞—è–≤–∫–∏: ${result.id}`);
        } catch (error) {
          resultDiv.textContent = "‚ùå –û—à–∏–±–∫–∞: " + error.message;
        }
      }

      // Test 2: –ü–æ–ª—É—á–∏—Ç—å –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
      async function testGetByPhone() {
        const phone = document.getElementById("phoneInput").value;
        const resultDiv = document.getElementById("result2");
        resultDiv.style.display = "block";
        resultDiv.textContent = `‚è≥ –ü–æ–∏—Å–∫ –∑–∞—è–≤–æ–∫ –¥–ª—è ${phone}...`;

        try {
          const complaints = await ComplaintsAPI.getComplaintsByPhone(phone);
          resultDiv.textContent = JSON.stringify(complaints, null, 2);

          if (complaints.length === 0) {
            alert("‚ÑπÔ∏è –ó–∞—è–≤–æ–∫ –¥–ª—è —ç—Ç–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ");
          } else {
            alert(`‚úÖ –ù–∞–π–¥–µ–Ω–æ –∑–∞—è–≤–æ–∫: ${complaints.length}`);
          }
        } catch (error) {
          resultDiv.textContent = "‚ùå –û—à–∏–±–∫–∞: " + error.message;
        }
      }

      // Test 3: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞—è–≤–∫–∏
      async function testGetAllComplaints() {
        const resultDiv = document.getElementById("result3");
        resultDiv.style.display = "block";
        resultDiv.textContent = "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫...";

        try {
          const response = await fetch("http://localhost:3000/api/complaints");
          const data = await response.json();
          resultDiv.textContent = JSON.stringify(data.data, null, 2);

          alert(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞—è–≤–æ–∫: ${data.data.length}`);
        } catch (error) {
          resultDiv.textContent = "‚ùå –û—à–∏–±–∫–∞: " + error.message;
        }
      }

      // Test 4: –ü–æ–ª—É—á–∏—Ç—å –ø–æ ID
      async function testGetById() {
        const id = document.getElementById("idInput").value;
        const resultDiv = document.getElementById("result4");
        resultDiv.style.display = "block";
        resultDiv.textContent = `‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–∫–∏ ‚Ññ${id}...`;

        try {
          const complaint = await ComplaintsAPI.getComplaintById(id);
          resultDiv.textContent = JSON.stringify(complaint, null, 2);

          alert(`‚úÖ –ó–∞—è–≤–∫–∞ ‚Ññ${id} –∑–∞–≥—Ä—É–∂–µ–Ω–∞`);
        } catch (error) {
          resultDiv.textContent = "‚ùå –û—à–∏–±–∫–∞: " + error.message;
          alert(`‚ùå –ó–∞—è–≤–∫–∞ ‚Ññ${id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞`);
        }
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      window.addEventListener("load", checkServer);
    </script>
  </body>
</html>
