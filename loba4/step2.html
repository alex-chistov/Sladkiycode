<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ ¬´–õ–æ–±–∞—á–µ–≤—Å–∫–∏–π¬ª - –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background-color: #f5f5f5;
        min-height: 100vh;
      }

      /* Header */
      .header {
        background-color: #fff;
        padding: 15px 40px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .logo img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .header-title {
        font-size: 18px;
        font-weight: 500;
        color: #333;
        flex: 1;
      }

      .header-link {
        color: #0066cc;
        text-decoration: none;
        font-size: 16px;
        font-weight: 500;
        transition: color 0.2s;
      }

      .header-link:hover {
        color: #0052a3;
        text-decoration: underline;
      }

      /* Container */
      .container {
        max-width: 800px;
        margin: 60px auto;
        padding: 0 20px;
      }

      /* Form Card */
      .form-card {
        background: #fff;
        border-radius: 12px;
        padding: 48px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      /* Header Section */
      .form-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }

      .form-title {
        font-size: 32px;
        font-weight: 600;
        color: #000;
      }

      .step-indicator {
        background: #fff;
        border: 1px solid #0066cc;
        color: #0066cc;
        padding: 8px 20px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
      }

      /* Form Description */
      .form-description {
        font-size: 16px;
        color: #666;
        margin-bottom: 32px;
        line-height: 1.5;
      }

      /* Form Group */
      .form-group {
        margin-bottom: 24px;
      }

      .form-label {
        display: flex;
        align-items: center;
        gap: 4px;
        margin-bottom: 8px;
        font-size: 15px;
        color: #333;
        font-weight: 500;
      }

      .required {
        color: #d32f2f;
      }

      /* Input */
      input[type="text"],
      input[type="tel"] {
        width: 100%;
        padding: 14px 16px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 15px;
        font-family: inherit;
        transition: border-color 0.2s;
      }

      input[type="text"]:focus,
      input[type="tel"]:focus {
        outline: none;
        border-color: #0066cc;
      }

      input::placeholder {
        color: #bbb;
      }

      /* Checkbox */
      .checkbox-group {
        margin: 32px 0;
        display: flex;
        align-items: flex-start;
        gap: 12px;
      }

      .checkbox-wrapper {
        display: flex;
        align-items: flex-start;
        cursor: pointer;
      }

      input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
        flex-shrink: 0;
        margin-top: 2px;
      }

      .checkbox-label {
        font-size: 14px;
        color: #333;
        line-height: 1.6;
        cursor: pointer;
      }

      .checkbox-label a {
        color: #0066cc;
        text-decoration: none;
      }

      .checkbox-label a:hover {
        text-decoration: underline;
      }

      /* Buttons */
      .btn-container {
        display: flex;
        justify-content: flex-end;
        gap: 16px;
        margin-top: 40px;
      }

      .btn {
        border: none;
        padding: 14px 40px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-secondary {
        background: #f0f0f0;
        color: #333;
      }

      .btn-secondary:hover {
        background: #e0e0e0;
      }

      .btn-primary {
        background: #95b3d4;
        color: #fff;
      }

      .btn-primary:hover {
        background: #7a9bc4;
      }

      .btn-primary:disabled {
        background: #95b3d4;
        opacity: 0.6;
        cursor: not-allowed;
      }

      .btn:active {
        transform: translateY(1px);
      }

      /* Responsive */
      @media (max-width: 768px) {
        .form-card {
          padding: 32px 24px;
        }

        .form-title {
          font-size: 24px;
        }

        .header {
          padding: 15px 20px;
        }

        .btn-container {
          flex-direction: column-reverse;
        }

        .btn {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="logo">
        <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect
            x="5"
            y="5"
            width="30"
            height="30"
            stroke="#000"
            stroke-width="2"
            fill="none"
          />
          <path
            d="M15 20 L20 25 L25 15"
            stroke="#000"
            stroke-width="2"
            fill="none"
          />
        </svg>
      </div>
      <div class="header-title">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ ¬´–õ–æ–±–∞—á–µ–≤—Å–∫–∏–π¬ª</div>
      <a href="my-applications.html" class="header-link">–ú–æ–∏ –∑–∞—è–≤–∫–∏</a>
    </div>

    <!-- Main Content -->
    <div class="container">
      <div class="form-card">
        <!-- Form Header -->
        <div class="form-header">
          <h1 class="form-title">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h1>
          <div class="step-indicator">–®–∞–≥ 2 –∏–∑ 2</div>
        </div>

        <!-- Description -->
        <p class="form-description">
          –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –º—ã —Å–º–æ–≥–ª–∏ —Å –≤–∞–º–∏ —Å–≤—è–∑–∞—Ç—å—Å—è.
        </p>

        <!-- Form -->
        <form id="personalDataForm">
          <!-- –§–∞–º–∏–ª–∏—è -->
          <div class="form-group">
            <label class="form-label">
              <span class="required">*</span>
              –§–∞–º–∏–ª–∏—è
            </label>
            <input type="text" id="lastName" required />
          </div>

          <!-- –ò–º—è -->
          <div class="form-group">
            <label class="form-label">
              <span class="required">*</span>
              –ò–º—è
            </label>
            <input type="text" id="firstName" required />
          </div>

          <!-- –û—Ç—á–µ—Å—Ç–≤–æ -->
          <div class="form-group">
            <label class="form-label">
              <span class="required">*</span>
              –û—Ç—á–µ—Å—Ç–≤–æ
            </label>
            <input type="text" id="middleName" required />
          </div>

          <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
          <div class="form-group">
            <label class="form-label">
              <span class="required">*</span>
              –¢–µ–ª–µ—Ñ–æ–Ω
            </label>
            <input
              type="tel"
              id="phone"
              placeholder="+7 (999) 123-45-67"
              required
            />
          </div>

          <!-- Checkbox Agreement -->
          <div class="checkbox-group">
            <input type="checkbox" id="agreement" required />
            <label for="agreement" class="checkbox-label">
              –Ø
              <a
                href="#"
                onclick="event.preventDefault(); alert('–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö');"
                >—Å–æ–≥–ª–∞—à–∞—é—Å—å</a
              >
              –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å
              <a
                href="#"
                onclick="event.preventDefault(); alert('–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞');"
                >–ü—Ä–∞–≤–∏–ª–∞–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</a
              >
              –∏ –ø—Ä–∏–Ω–∏–º–∞—é —É—Å–ª–æ–≤–∏—è
              <a
                href="#"
                onclick="event.preventDefault(); alert('–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ');"
                >–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
                –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Ä–æ–¥–∞ –ù–∏–∂–Ω–µ–≥–æ
                –ù–æ–≤–≥–æ—Ä–æ–¥–∞ ¬´–õ–æ–±–∞—á–µ–≤—Å–∫–∏–π¬ª</a
              >
            </label>
          </div>

          <!-- Submit Buttons -->
          <div class="btn-container">
            <button type="button" class="btn btn-secondary" onclick="goBack()">
              –ù–∞–∑–∞–¥
            </button>
            <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </div>
        </form>
      </div>
    </div>

    <script src="api-client.js"></script>
    <script>
      // Phone mask
      const phoneInput = document.getElementById("phone");
      phoneInput.addEventListener("input", function (e) {
        let value = e.target.value.replace(/\D/g, "");
        if (value.length > 0) {
          if (value[0] !== "7") {
            value = "7" + value;
          }
          let formattedValue = "+7";
          if (value.length > 1) {
            formattedValue += " (" + value.substring(1, 4);
          }
          if (value.length >= 5) {
            formattedValue += ") " + value.substring(4, 7);
          }
          if (value.length >= 8) {
            formattedValue += "-" + value.substring(7, 9);
          }
          if (value.length >= 10) {
            formattedValue += "-" + value.substring(9, 11);
          }
          e.target.value = formattedValue;
        }
      });

      // Go back function
      function goBack() {
        window.history.back();
      }

      // Form submission
      document
        .getElementById("personalDataForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const agreement = document.getElementById("agreement");
          if (!agreement.checked) {
            alert(
              "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–∞–π—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"
            );
            return;
          }

          // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
          const lastName = document.getElementById("lastName").value;
          const firstName = document.getElementById("firstName").value;
          const middleName = document.getElementById("middleName").value;
          const phone = document.getElementById("phone").value;

          // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞ (–∏–∑ sessionStorage)
          const step1Data = JSON.parse(
            sessionStorage.getItem("step1Data") || "{}"
          );

          // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω–æ–µ –∏–º—è –∞–≤—Ç–æ—Ä–∞
          const fullName = `${lastName} ${firstName} ${middleName}`;

          // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –ë–î
          const complaintData = {
            title: step1Data.address || "–ó–∞—è–≤–∫–∞ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –õ–æ–±–∞—á–µ–≤—Å–∫–∏–π",
            description: step1Data.description || "",
            author: fullName,
            author_phone: phone,
            author_address: step1Data.address || "",
            status: "–ù–æ–≤–æ–µ",
            external_system: "–°–∞–π—Ç lbch.ru",
            created_date: new Date().toISOString(),
          };

          console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏:", complaintData);

          try {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞—è–≤–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            const result = await ComplaintsAPI.createComplaint(complaintData);

            console.log("‚úÖ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞, ID:", result.id);

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
            localStorage.setItem("userPhone", phone);
            localStorage.setItem("lastComplaintId", result.id);

            // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞
            sessionStorage.removeItem("step1Data");

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –∑–∞—è–≤–∫–µ
            if (
              confirm(
                `‚úÖ –ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!\n\n–ù–æ–º–µ—Ä –∑–∞—è–≤–∫–∏: ‚Ññ${result.id}\n\n–•–æ—Ç–∏—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –∑–∞—è–≤–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞?`
              )
            ) {
              // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –¥–µ—Ç–∞–ª—å–Ω–æ–º—É –ø—Ä–æ—Å–º–æ—Ç—Ä—É –∑–∞—è–≤–∫–∏
              window.location.href = `complaint-detail.html?id=${result.id}`;
            } else {
              // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
              window.location.href = "my-applications.html";
            }
          } catch (error) {
            console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏:", error);
            alert(
              "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (npm start –≤ –ø–∞–ø–∫–µ adminka), –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
            );
          }
        });
    </script>
  </body>
</html>
